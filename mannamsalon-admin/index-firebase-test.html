<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Firebase 연결 테스트</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #3b82f6;
      padding-bottom: 10px;
    }
    .status {
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
      font-size: 14px;
    }
    .success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    pre {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      font-size: 12px;
    }
    button {
      background: #3b82f6;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      margin: 5px;
    }
    button:hover {
      background: #2563eb;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🔥 Firebase 연결 테스트</h1>
    
    <div id="status"></div>
    
    <h3>테스트 결과:</h3>
    <div id="results"></div>
    
    <h3>관리자 계정 생성:</h3>
    <div style="margin: 20px 0;">
      <input type="email" id="adminEmail" placeholder="이메일" value="admin@matnam.com" style="padding: 8px; width: 250px; margin-right: 10px;">
      <input type="password" id="adminPassword" placeholder="비밀번호" value="Matnam2025!" style="padding: 8px; width: 200px; margin-right: 10px;">
      <button onclick="createAdminAccount()">관리자 계정 생성</button>
    </div>
    
    <div style="margin-top: 20px;">
      <button onclick="window.location.href='login.html'">로그인 페이지로 이동</button>
      <button onclick="window.location.href='index.html'">메인으로</button>
    </div>
  </div>

  <!-- Firebase SDK (CDN) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };

    let app, auth, db;
    const statusDiv = document.getElementById('status');
    const resultsDiv = document.getElementById('results');

    // 테스트 시작
    function runTests() {
      let results = '';

      // 1. Firebase SDK 로드 확인
      if (typeof firebase !== 'undefined') {
        results += '<div class="status success">✅ Firebase SDK 로드 성공</div>';
        
        try {
          // 2. Firebase 초기화
          app = firebase.initializeApp(firebaseConfig);
          results += '<div class="status success">✅ Firebase 앱 초기화 성공</div>';
          
          // 3. Authentication 초기화
          auth = firebase.auth();
          results += '<div class="status success">✅ Firebase Authentication 초기화 성공</div>';
          
          // 4. Firestore 초기화
          db = firebase.firestore();
          results += '<div class="status success">✅ Firestore 초기화 성공</div>';
          
          // 5. 프로젝트 정보 표시
          results += '<div class="status info">';
          results += '<strong>📋 프로젝트 정보:</strong><br>';
          results += `프로젝트 ID: ${firebaseConfig.projectId}<br>`;
          results += `Auth 도메인: ${firebaseConfig.authDomain}`;
          results += '</div>';
          
          statusDiv.innerHTML = '<div class="status success"><strong>🎉 Firebase 연결 성공!</strong><br>모든 테스트를 통과했습니다.</div>';
          
        } catch (error) {
          results += `<div class="status error">❌ Firebase 초기화 실패: ${error.message}</div>`;
          statusDiv.innerHTML = '<div class="status error"><strong>⚠️ 초기화 실패</strong></div>';
        }
        
      } else {
        results += '<div class="status error">❌ Firebase SDK를 로드할 수 없습니다.</div>';
        results += '<div class="status info">💡 웹 서버를 통해 페이지를 열어주세요 (file:/// 대신 http://localhost)</div>';
        statusDiv.innerHTML = '<div class="status error"><strong>⚠️ SDK 로드 실패</strong></div>';
      }

      resultsDiv.innerHTML = results;
    }

    // 관리자 계정 생성
    async function createAdminAccount() {
      const email = document.getElementById('adminEmail').value.trim();
      const password = document.getElementById('adminPassword').value;

      if (!email || !password) {
        alert('이메일과 비밀번호를 입력하세요.');
        return;
      }

      try {
        statusDiv.innerHTML = '<div class="status info">⏳ 관리자 계정 생성 중...</div>';

        // 1. Firebase Authentication에 사용자 생성
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;

        console.log('✅ Auth 사용자 생성 완료:', user.uid);

        // 2. Firestore에 관리자 정보 저장
        await db.collection('users').doc(user.uid).set({
          uid: user.uid,
          email: email,
          name: '관리자',
          phone: '010-0000-0000',
          birth: '1990-01-01',
          role: 'admin',
          userType: 'admin',
          store: '본사',
          position: '시스템 관리자',
          status: 'active',
          address: '경기도 부천시',
          createdAt: firebase.firestore.Timestamp.now(),
          joinedAt: firebase.firestore.Timestamp.now()
        });

        console.log('✅ Firestore 데이터 저장 완료');

        statusDiv.innerHTML = `
          <div class="status success">
            <strong>✅ 관리자 계정 생성 완료!</strong><br><br>
            <strong>이메일:</strong> ${email}<br>
            <strong>비밀번호:</strong> ${password}<br><br>
            <button onclick="window.location.href='login.html'">로그인 페이지로 이동</button>
          </div>
        `;

      } catch (error) {
        console.error('❌ 계정 생성 실패:', error);
        
        let errorMsg = error.message;
        if (error.code === 'auth/email-already-in-use') {
          errorMsg = '이미 사용 중인 이메일입니다.';
        } else if (error.code === 'auth/weak-password') {
          errorMsg = '비밀번호가 너무 약합니다. (최소 6자)';
        } else if (error.code === 'auth/invalid-email') {
          errorMsg = '올바른 이메일 형식이 아닙니다.';
        }
        
        statusDiv.innerHTML = `<div class="status error"><strong>❌ 계정 생성 실패</strong><br>${errorMsg}</div>`;
      }
    }

    // 페이지 로드 시 테스트 실행
    window.addEventListener('load', runTests);
  </script>
</body>
</html>
