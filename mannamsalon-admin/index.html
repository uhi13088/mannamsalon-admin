<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ÎßõÎÇ®ÏÇ¥Î°± Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root {
      --primary-color: #8b7355; --primary-dark: #6b5d4f; --bg-light: #f5f1e8; --bg-white: #fdfcfa;
      --text-primary: #6b5d4f; --text-secondary: #9b8a76; --border-color: #e8dfd0; --border-radius: 8px;
      --shadow-sm: 0 2px 8px rgba(107, 93, 79, 0.08); --shadow-lg: 0 8px 24px rgba(107, 93, 79, 0.15);
      --spacing-xs: 6px; --spacing-sm: 12px; --spacing-md: 16px; --spacing-lg: 24px; --spacing-xl: 32px;
      --success-color: #7a9b7a; --warning-color: #d4a574; --danger-color: #c67b7b;
    }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', 'Malgun Gothic', sans-serif; background: var(--bg-light); color: var(--text-primary); }
    .hidden { display: none !important; }
    #loginScreen { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 20px; }
    .login-box { background: var(--bg-white); border-radius: 12px; padding: 48px 40px; box-shadow: var(--shadow-lg); max-width: 420px; width: 100%; border: 1px solid var(--border-color); text-align: center; }
    .login-logo { font-size: 64px; margin-bottom: 16px; }
    .login-box h1 { font-size: 28px; color: var(--text-primary); margin-bottom: 8px; }
    .login-subtitle { color: var(--text-secondary); margin-bottom: 32px; font-size: 14px; }
    .form-group { margin-bottom: 20px; text-align: left; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: var(--text-primary); font-size: 14px; }
    .form-group input { width: 100%; padding: 14px 16px; border: 2px solid var(--border-color); border-radius: var(--border-radius); font-size: 15px; }
    .btn { padding: 12px 24px; border-radius: var(--border-radius); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; border: none; }
    .btn-primary { background: var(--primary-color); color: var(--bg-white); }
    .btn-primary:hover { background: var(--primary-dark); box-shadow: var(--shadow-sm); }
    .btn-secondary { background: var(--bg-light); color: var(--text-primary); border: 1px solid var(--border-color); }
    .btn-sm { padding: 8px 16px; font-size: 12px; }
    .btn-danger { background: var(--danger-color); color: var(--bg-white); }
    .btn-success { background: var(--success-color); color: var(--bg-white); }
    .container { max-width: 1200px; margin: 0 auto; padding: var(--spacing-lg); }
    .top-bar { background: var(--bg-white); padding: var(--spacing-lg); box-shadow: var(--shadow-sm); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; margin-bottom: var(--spacing-xl); }
    .admin-badge { background: var(--primary-color); color: var(--bg-white); padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 600; }
    .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl); }
    .dashboard-card { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); padding: var(--spacing-lg); box-shadow: var(--shadow-sm); }
    .dashboard-card-icon { font-size: 36px; margin-bottom: var(--spacing-sm); }
    .dashboard-card-label { color: var(--text-secondary); font-size: 13px; margin-bottom: var(--spacing-xs); }
    .dashboard-card-value { font-size: 32px; font-weight: 700; color: var(--text-primary); }
    .dashboard-card-sub { font-size: 13px; color: var(--text-secondary); margin-top: var(--spacing-xs); }
    .tabs { display: flex; gap: var(--spacing-xs); margin-bottom: var(--spacing-lg); border-bottom: 2px solid var(--border-color); overflow-x: auto; flex-wrap: wrap; }
    .tab { padding: var(--spacing-md) var(--spacing-lg); background: none; border: none; color: var(--text-secondary); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; border-bottom: 3px solid transparent; white-space: nowrap; }
    .tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .card { background: var(--bg-white); border: 1px solid var(--border-color); border-radius: var(--border-radius); margin-bottom: var(--spacing-lg); box-shadow: var(--shadow-sm); }
    .card-header { padding: var(--spacing-lg); border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
    .card-header h3 { font-size: 16px; font-weight: 600; color: var(--text-primary); margin: 0; }
    .card-body { padding: var(--spacing-lg); }
    table { width: 100%; border-collapse: collapse; }
    table th { background: var(--bg-light); padding: 12px; text-align: left; font-weight: 600; color: var(--text-primary); border-bottom: 2px solid var(--border-color); font-size: 13px; }
    table td { padding: 12px; border-bottom: 1px solid var(--border-color); font-size: 14px; color: var(--text-primary); }
    .badge { display: inline-block; padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 500; }
    .badge-success { background: #e6f2e6; color: #4a6b4a; }
    .badge-warning { background: #f5ead9; color: #8b6846; }
    .badge-danger { background: #f5e3e3; color: #8b5555; }
    .badge-info { background: #e3ebf2; color: #5a708a; }
    .badge-primary { background: #e3ebf2; color: #5a708a; }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); display: flex; align-items: center; justify-content: center; z-index: 9999; padding: 20px; }
    .modal-content { background: var(--bg-white); border-radius: 16px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg); border: 1px solid var(--border-color); }
    .modal-header { padding: 25px 30px; border-bottom: 2px solid var(--bg-light); display: flex; justify-content: space-between; align-items: center; }
    .modal-body { padding: 30px; }
    .modal-footer { padding: 20px 30px; border-top: 2px solid var(--bg-light); text-align: right; display: flex; gap: 8px; justify-content: flex-end; }
    .modal-close { background: none; border: none; font-size: 28px; color: var(--text-secondary); cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; }
    .modal-close:hover { background: var(--bg-light); color: var(--text-primary); }
    .filters { display: flex; gap: var(--spacing-md); margin-bottom: var(--spacing-lg); flex-wrap: wrap; }
    .filter-group { flex: 1; min-width: 200px; }
    .filter-group label { display: block; margin-bottom: var(--spacing-xs); font-weight: 600; color: var(--text-primary); font-size: 13px; }
    .filter-group input, .filter-group select { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: var(--border-radius); font-size: 14px; }
  </style>
</head>
<body>
  <div id="loginScreen">
    <div class="login-box">
      <div class="login-logo">‚òï</div>
      <h1>ÎßõÎÇ®ÏÇ¥Î°±</h1>
      <p class="login-subtitle">Í¥ÄÎ¶¨Ïûê Î°úÍ∑∏Ïù∏</p>
      <div class="form-group">
        <label for="adminEmail">Ïù¥Î©îÏùº</label>
        <input type="email" id="adminEmail" placeholder="Ïù¥Î©îÏùº Ï£ºÏÜåÎ•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onkeypress="if(event.key==='Enter') document.getElementById('adminPassword').focus()">
      </div>
      <div class="form-group">
        <label for="adminPassword">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
        <input type="password" id="adminPassword" placeholder="ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî" onkeypress="if(event.key==='Enter') handleAdminLogin()">
      </div>
      <button class="btn btn-primary" style="width: 100%;" onclick="handleAdminLogin()">Î°úÍ∑∏Ïù∏</button>
      <p id="loginError" style="color: #c67b7b; font-size: 13px; margin-top: 12px; display: none;"></p>
    </div>
  </div>

  <div id="mainScreen" class="hidden">
    <div class="top-bar">
      <h1 style="font-size: 20px; font-weight: 700; margin: 0;">üè™ ÎßõÎÇ®ÏÇ¥Î°± Í∑ºÎ¨¥Í¥ÄÎ¶¨</h1>
      <div style="display: flex; align-items: center; gap: 16px;">
        <span class="admin-badge">Í¥ÄÎ¶¨Ïûê</span>
        <button class="btn btn-secondary" onclick="logout()">Î°úÍ∑∏ÏïÑÏõÉ</button>
      </div>
    </div>

    <div class="container">
      <div class="dashboard-cards">
        <div class="dashboard-card">
          <div class="dashboard-card-icon">üë•</div>
          <div class="dashboard-card-label">Ï¥ù ÏßÅÏõê Ïàò</div>
          <div class="dashboard-card-value" id="totalEmployees">0</div>
          <div class="dashboard-card-sub">Î™Ö</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">‚úÖ</div>
          <div class="dashboard-card-label">Ïò§Îäò Ï∂úÍ∑º</div>
          <div class="dashboard-card-value" id="todayAttendance">0</div>
          <div class="dashboard-card-sub">Î™Ö</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">‚è∞</div>
          <div class="dashboard-card-label">ÏäπÏù∏ ÎåÄÍ∏∞</div>
          <div class="dashboard-card-value" id="pendingApprovals">0</div>
          <div class="dashboard-card-sub">Í±¥</div>
        </div>
        <div class="dashboard-card">
          <div class="dashboard-card-icon">üìÑ</div>
          <div class="dashboard-card-label">ÎØ∏ÏÑúÎ™Ö Í≥ÑÏïΩÏÑú</div>
          <div class="dashboard-card-value" id="unsignedContracts">0</div>
          <div class="dashboard-card-sub">Í±¥</div>
        </div>
      </div>

      <div class="tabs">
        <button class="tab active" data-tab="dashboard" onclick="switchTab('dashboard')">üìä ÎåÄÏãúÎ≥¥Îìú</button>
        <button class="tab" data-tab="employees" onclick="switchTab('employees')">üë• ÏßÅÏõê Í¥ÄÎ¶¨</button>
        <button class="tab" data-tab="attendance" onclick="switchTab('attendance')">üìã Í∑ºÌÉú Í¥ÄÎ¶¨</button>
        <button class="tab" data-tab="salary" onclick="switchTab('salary')">üí∞ Í∏âÏó¨ Í¥ÄÎ¶¨</button>
        <button class="tab" data-tab="approvals" onclick="switchTab('approvals')">‚úîÔ∏è ÏäπÏù∏ Í¥ÄÎ¶¨</button>
        <button class="tab" data-tab="contracts" onclick="switchTab('contracts')">üìù Í≥ÑÏïΩÏÑú Í¥ÄÎ¶¨</button>
        <button class="tab" data-tab="notice" onclick="switchTab('notice')">üì¢ Í≥µÏßÄÏÇ¨Ìï≠</button>
      </div>

      <div id="tabDashboard" class="tab-content active">
        <div class="card">
          <div class="card-header"><h3>üìä ÌòÑÌô© ÏöîÏïΩ</h3></div>
          <div class="card-body"><p style="color: var(--text-secondary);">Í¥ÄÎ¶¨Ïûê ÌéòÏù¥ÏßÄÏóê Ïò§Ïã† Í≤ÉÏùÑ ÌôòÏòÅÌï©ÎãàÎã§.</p></div>
        </div>
      </div>

      <div id="tabEmployees" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>üë• ÏßÅÏõê Î™©Î°ù</h3>
            <button class="btn btn-primary" onclick="window.location.href='contract.html'">+ ÏßÅÏõê Ï∂îÍ∞Ä</button>
          </div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>Îß§Ïû•</label>
                <select id="employeeStoreFilter">
                  <option value="">Ï†ÑÏ≤¥</option>
                  <option value="Î∂ÄÏ≤úÏãúÏ≤≠Ï†ê">Î∂ÄÏ≤úÏãúÏ≤≠Ï†ê</option>
                  <option value="ÏÉÅÎèôÏ†ê">ÏÉÅÎèôÏ†ê</option>
                  <option value="Î∂ÄÏ≤úÏó≠ÏÇ¨Ï†ê">Î∂ÄÏ≤úÏó≠ÏÇ¨Ï†ê</option>
                </select>
              </div>
              <div class="filter-group">
                <label>ÏÉÅÌÉú</label>
                <select id="employeeStatusFilter">
                  <option value="">Ï†ÑÏ≤¥</option>
                  <option value="Ïû¨ÏßÅ">Ïû¨ÏßÅ</option>
                  <option value="Ìá¥ÏÇ¨">Ìá¥ÏÇ¨</option>
                </select>
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadEmployees()">Ï°∞Ìöå</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Ïù¥Î¶Ñ</th>
                  <th>Îß§Ïû•</th>
                  <th>ÏßÅÍ∏â</th>
                  <th>ÏãúÍ∏â</th>
                  <th>ÏûÖÏÇ¨Ïùº</th>
                  <th>ÏÉÅÌÉú</th>
                  <th>Í¥ÄÎ¶¨</th>
                </tr>
              </thead>
              <tbody id="employeeTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                    <p style="margin-bottom: 16px;">ÏßÅÏõê Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</p>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabAttendance" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>üìã Í∑ºÌÉú Í∏∞Î°ù</h3></div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>Ï°∞Ìöå Ïõî</label>
                <input type="month" id="attendanceMonth">
              </div>
              <div class="filter-group">
                <label>Îß§Ïû•</label>
                <select id="attendanceStoreFilter">
                  <option value="">Ï†ÑÏ≤¥</option>
                  <option value="Î∂ÄÏ≤úÏãúÏ≤≠Ï†ê">Î∂ÄÏ≤úÏãúÏ≤≠Ï†ê</option>
                  <option value="ÏÉÅÎèôÏ†ê">ÏÉÅÎèôÏ†ê</option>
                  <option value="Î∂ÄÏ≤úÏó≠ÏÇ¨Ï†ê">Î∂ÄÏ≤úÏó≠ÏÇ¨Ï†ê</option>
                </select>
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadAttendanceList()">Ï°∞Ìöå</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>ÎÇ†Ïßú</th>
                  <th>Ïù¥Î¶Ñ</th>
                  <th>Îß§Ïû•</th>
                  <th>Ï∂úÍ∑º</th>
                  <th>Ìá¥Í∑º</th>
                  <th>Í∑ºÎ¨¥ÏãúÍ∞Ñ</th>
                  <th>ÏÉÅÌÉú</th>
                </tr>
              </thead>
              <tbody id="attendanceTableBody">
                <tr>
                  <td colspan="7" style="text-align: center; color: var(--text-secondary);">Í∑ºÌÉú Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabSalary" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>üí∞ Í∏âÏó¨ ÎÇ¥Ïó≠</h3></div>
          <div class="card-body">
            <div class="filters">
              <div class="filter-group">
                <label>Ï°∞Ìöå Ïõî</label>
                <input type="month" id="salaryMonth">
              </div>
              <div class="filter-group">
                <label>&nbsp;</label>
                <button class="btn btn-primary" onclick="loadSalaryList()">Ï°∞Ìöå</button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Ïù¥Î¶Ñ</th>
                  <th>Îß§Ïû•</th>
                  <th>Í∏∞Î≥∏Í∏â</th>
                  <th>Ï∂îÍ∞ÄÏàòÎãπ</th>
                  <th>Í≥µÏ†ú</th>
                  <th>Ïã§ÏßÄÍ∏âÏï°</th>
                </tr>
              </thead>
              <tbody id="salaryTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; color: var(--text-secondary);">Í∏âÏó¨ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabApprovals" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>‚úîÔ∏è ÏäπÏù∏ ÎåÄÍ∏∞ Î™©Î°ù</h3></div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>Ïú†Ìòï</th>
                  <th>Ïã†Ï≤≠Ïûê</th>
                  <th>ÎÇ†Ïßú</th>
                  <th>ÎÇ¥Ïö©</th>
                  <th>ÏÉÅÌÉú</th>
                  <th>Ï≤òÎ¶¨</th>
                </tr>
              </thead>
              <tbody id="approvalsTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; color: var(--text-secondary);">ÏäπÏù∏ ÎåÄÍ∏∞ Í±¥Ïù¥ ÏóÜÏäµÎãàÎã§.</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabContracts" class="tab-content">
        <div class="card">
          <div class="card-header">
            <h3>üìù Í≥ÑÏïΩÏÑú Î™©Î°ù</h3>
            <button class="btn btn-primary" onclick="openContractPage()">+ ÏÉà Í≥ÑÏïΩÏÑú ÏûëÏÑ±</button>
          </div>
          <div class="card-body">
            <table>
              <thead>
                <tr>
                  <th>ÏßÅÏõêÎ™Ö</th>
                  <th>Í≥ÑÏïΩ Ïú†Ìòï</th>
                  <th>Í≥ÑÏïΩ Í∏∞Í∞Ñ</th>
                  <th>ÏûëÏÑ±Ïùº</th>
                  <th>ÏÉÅÌÉú</th>
                  <th>Í¥ÄÎ¶¨</th>
                </tr>
              </thead>
              <tbody id="contractsTableBody">
                <tr>
                  <td colspan="6" style="text-align: center; color: var(--text-secondary);">Í≥ÑÏïΩÏÑú Ï†ïÎ≥¥Î•º Î∂àÎü¨Ïò§Îäî Ï§ë...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div id="tabNotice" class="tab-content">
        <div class="card">
          <div class="card-header"><h3>üì¢ Í≥µÏßÄÏÇ¨Ìï≠ Í¥ÄÎ¶¨</h3></div>
          <div class="card-body">
            <p style="color: var(--text-secondary);">Í≥µÏßÄÏÇ¨Ìï≠ Í∏∞Îä•ÏùÄ Í∞úÎ∞ú Ï§ëÏûÖÎãàÎã§.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let isAuthenticated = false;
    let currentTab = 'dashboard';

    const DUMMY_EMPLOYEES = [
      { id: 1, name: 'ÍπÄÎØºÏàò', store: 'Î∂ÄÏ≤úÏãúÏ≤≠Ï†ê', position: 'Îß§ÎãàÏ†Ä', hourlyWage: '15,000Ïõê', startDate: '2023-01-15', status: 'Ïû¨ÏßÅ' },
      { id: 2, name: 'Ïù¥ÏßÄÏùÄ', store: 'ÏÉÅÎèôÏ†ê', position: 'Î∞îÎ¶¨Ïä§ÌÉÄ', hourlyWage: '10,500Ïõê', startDate: '2023-03-20', status: 'Ïû¨ÏßÅ' },
      { id: 3, name: 'Î∞ïÏÑúÏ§Ä', store: 'Î∂ÄÏ≤úÏó≠ÏÇ¨Ï†ê', position: 'Î∞îÎ¶¨Ïä§ÌÉÄ', hourlyWage: '10,000Ïõê', startDate: '2023-05-10', status: 'Ïû¨ÏßÅ' },
    ];

    const DUMMY_ATTENDANCE = [
      { id: 1, date: '2025-01-28', name: 'ÍπÄÎØºÏàò', store: 'Î∂ÄÏ≤úÏãúÏ≤≠Ï†ê', clockIn: '09:00', clockOut: '18:00', workTime: '8ÏãúÍ∞Ñ', status: 'Ï†ïÏÉÅ' },
      { id: 2, date: '2025-01-28', name: 'Ïù¥ÏßÄÏùÄ', store: 'ÏÉÅÎèôÏ†ê', clockIn: '09:05', clockOut: '18:00', workTime: '7ÏãúÍ∞Ñ 55Î∂Ñ', status: 'ÏßÄÍ∞Å' },
    ];

    const DUMMY_SALARIES = [
      { id: 1, name: 'ÍπÄÎØºÏàò', store: 'Î∂ÄÏ≤úÏãúÏ≤≠Ï†ê', basicPay: 3000000, overtimePay: 200000, deductions: 300000, totalPay: 2900000 },
      { id: 2, name: 'Ïù¥ÏßÄÏùÄ', store: 'ÏÉÅÎèôÏ†ê', basicPay: 1800000, overtimePay: 150000, deductions: 195000, totalPay: 1755000 },
    ];

    document.addEventListener('DOMContentLoaded', function() {
      const today = new Date();
      const currentMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
      const monthFilters = ['attendanceMonth', 'salaryMonth'];
      monthFilters.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.value = currentMonth;
      });
      checkAuthStatus();
    });

    function checkAuthStatus() {
      const savedAuth = sessionStorage.getItem('admin_authenticated');
      if (savedAuth === 'true') {
        isAuthenticated = true;
        showMainScreen();
      } else {
        showLoginScreen();
      }
    }

    async function handleAdminLogin() {
      const email = document.getElementById('adminEmail').value.trim();
      const password = document.getElementById('adminPassword').value;
      const errorEl = document.getElementById('loginError');
      
      if (!email) {
        errorEl.textContent = 'Ïù¥Î©îÏùºÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
        errorEl.style.display = 'block';
        return;
      }
      if (!password) {
        errorEl.textContent = 'ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.';
        errorEl.style.display = 'block';
        return;
      }

      try {
        errorEl.style.display = 'none';
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        const userDoc = await db.collection('users').doc(user.uid).get();
        
        if (userDoc.exists) {
          const userData = userDoc.data();
          if (userData.role === 'admin' || userData.role === 'manager') {
            isAuthenticated = true;
            sessionStorage.setItem('admin_authenticated', 'true');
            showMainScreen();
          } else {
            errorEl.textContent = 'Í¥ÄÎ¶¨Ïûê Í∂åÌïúÏù¥ ÏóÜÏäµÎãàÎã§.';
            errorEl.style.display = 'block';
            await auth.signOut();
          }
        } else {
          errorEl.textContent = 'ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥Î•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.';
          errorEl.style.display = 'block';
          await auth.signOut();
        }
      } catch (error) {
        console.error('Î°úÍ∑∏Ïù∏ Ïò§Î•ò:', error);
        if (error.code === 'auth/user-not-found') errorEl.textContent = 'Îì±Î°ùÎêòÏßÄ ÏïäÏùÄ Ïù¥Î©îÏùºÏûÖÎãàÎã§.';
        else if (error.code === 'auth/wrong-password') errorEl.textContent = 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.';
        else if (error.code === 'auth/invalid-email') errorEl.textContent = 'Ïù¥Î©îÏùº ÌòïÏãùÏù¥ Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§.';
        else errorEl.textContent = 'Î°úÍ∑∏Ïù∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.';
        errorEl.style.display = 'block';
        document.getElementById('adminPassword').value = '';
      }
    }

    async function logout() {
      if (confirm('Î°úÍ∑∏ÏïÑÏõÉ ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        try {
          await auth.signOut();
          isAuthenticated = false;
          sessionStorage.removeItem('admin_authenticated');
          showLoginScreen();
        } catch (error) {
          console.error('Î°úÍ∑∏ÏïÑÏõÉ Ïò§Î•ò:', error);
        }
      }
    }

    function showLoginScreen() {
      document.getElementById('loginScreen').classList.remove('hidden');
      document.getElementById('mainScreen').classList.add('hidden');
    }

    function showMainScreen() {
      document.getElementById('loginScreen').classList.add('hidden');
      document.getElementById('mainScreen').classList.remove('hidden');
      loadDashboard();
      switchTab('employees');
    }

    function switchTab(tabName) {
      currentTab = tabName;
      document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
        content.style.display = 'none';
      });
      const selectedTab = document.querySelector(`[data-tab="${tabName}"]`);
      if (selectedTab) selectedTab.classList.add('active');
      const capitalize = (str) => str.charAt(0).toUpperCase() + str.slice(1);
      const tabId = `tab${capitalize(tabName)}`;
      const selectedContent = document.getElementById(tabId);
      if (selectedContent) {
        selectedContent.classList.add('active');
        selectedContent.style.display = 'block';
      }
      switch(tabName) {
        case 'dashboard': loadDashboard(); break;
        case 'employees': loadEmployees(); break;
        case 'attendance': loadAttendanceList(); break;
        case 'salary': loadSalaryList(); break;
        case 'approvals': loadApprovals(); break;
        case 'contracts': loadContracts(); break;
        case 'notice': loadNotice(); break;
      }
    }

    function loadDashboard() {
      let totalContracts = 0;
      let unsignedContracts = 0;
      const employeeMap = new Map();
      
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          try {
            const contractData = JSON.parse(localStorage.getItem(key));
            const contractId = key.replace('contract_', '');
            const signedContracts = JSON.parse(localStorage.getItem('signedContracts') || '[]');
            const isSigned = signedContracts.some(sc => sc.id === contractId);
            
            const empKey = contractData.employeeName + '_' + contractData.employeeBirth;
            if (!employeeMap.has(empKey)) {
              employeeMap.set(empKey, true);
              totalContracts++;
            }
            
            if (!isSigned) unsignedContracts++;
          } catch(e) {}
        }
      }
      
      document.getElementById('totalEmployees').textContent = totalContracts;
      document.getElementById('todayAttendance').textContent = '0';
      document.getElementById('pendingApprovals').textContent = '0';
      document.getElementById('unsignedContracts').textContent = unsignedContracts;
    }

    function updateDashboardCard(id, value, subtitle) {
      const valueElement = document.getElementById(id);
      if (valueElement) {
        valueElement.textContent = value;
        if (subtitle) {
          const subElement = valueElement.nextElementSibling;
          if (subElement) subElement.textContent = subtitle;
        }
      }
    }

    function loadEmployees() {
      const tbody = document.getElementById('employeeTableBody');
      if (!tbody) return;
      
      const employeeMap = new Map();
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          try {
            const contractData = JSON.parse(localStorage.getItem(key));
            const contractId = key.replace('contract_', '');
            const signedContracts = JSON.parse(localStorage.getItem('signedContracts') || '[]');
            const isSigned = signedContracts.some(sc => sc.id === contractId);
            const empKey = contractData.employeeName + '_' + contractData.employeeBirth;
            if (!employeeMap.has(empKey)) {
              employeeMap.set(empKey, {
                name: contractData.employeeName,
                store: contractData.workStore,
                position: contractData.position,
                wage: `${contractData.wageType} ${contractData.wageAmount}Ïõê`,
                startDate: contractData.startDate,
                status: isSigned ? 'Í∑ºÎ¨¥Ï§ë' : 'ÏÑúÎ™ÖÎåÄÍ∏∞',
                contractId: contractId,
                phone: contractData.employeePhone
              });
            }
          } catch (e) {}
        }
      }
      
      const employees = Array.from(employeeMap.values());
      if (employees.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="7" style="text-align: center; padding: 40px; color: var(--text-secondary);">
              <p style="margin-bottom: 16px;">Í≥ÑÏïΩÏÑúÍ∞Ä ÏûëÏÑ±Îêú ÏßÅÏõêÏù¥ ÏóÜÏäµÎãàÎã§.</p>
              <button class="btn btn-primary" onclick="openContractPage()">+ Ï≤´ Í≥ÑÏïΩÏÑú ÏûëÏÑ±ÌïòÍ∏∞</button>
            </td>
          </tr>
        `;
        return;
      }
      
      tbody.innerHTML = employees.map(emp => `
        <tr>
          <td>${emp.name}</td>
          <td>${emp.store}</td>
          <td>${emp.position}</td>
          <td>${emp.wage}</td>
          <td>${emp.startDate}</td>
          <td><span class="badge ${emp.status === 'Í∑ºÎ¨¥Ï§ë' ? 'badge-success' : 'badge-warning'}">${emp.status}</span></td>
          <td>
            <button class="btn btn-sm btn-secondary" onclick="showEmployeeContractList('${emp.name}')">üìÑ Í≥ÑÏïΩÏÑú</button>
          </td>
        </tr>
      `).join('');
    }

    function showEmployeeContractList(employeeName) {
      const contracts = [];
      let employeeId = null;
      
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          const contractData = JSON.parse(localStorage.getItem(key));
          if (contractData.employeeName === employeeName) {
            const contractId = key.replace('contract_', '');
            if (!employeeId) employeeId = getEmployeeIdFromContract(contractData);
            const signedContracts = JSON.parse(localStorage.getItem('signedContracts') || '[]');
            const isSigned = signedContracts.some(sc => sc.id === contractId);
            contracts.push({
              id: contractId,
              data: contractData,
              isSigned: isSigned,
              createdAt: contractData.createdAt || null
            });
          }
        }
      }
      
      if (contracts.length === 0) {
        alert('‚ö†Ô∏è Ìï¥Îãπ ÏßÅÏõêÏùò Í≥ÑÏïΩÏÑúÍ∞Ä ÏóÜÏäµÎãàÎã§.');
        return;
      }
      
      contracts.sort((a, b) => {
        const dateA = a.createdAt ? new Date(a.createdAt) : new Date(0);
        const dateB = b.createdAt ? new Date(b.createdAt) : new Date(0);
        return dateB - dateA;
      });
      
      const docKey = `employee_docs_${employeeName}_${employeeId}`;
      const employeeDocs = JSON.parse(localStorage.getItem(docKey) || '{}');
      
      let bankAccountHtml = '';
      if (employeeDocs.bankAccount) {
        const ba = employeeDocs.bankAccount;
        bankAccountHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: #f0f9ff; border-radius: var(--border-radius); border-left: 4px solid #3b82f6;">
            <h4 style="margin-bottom: var(--spacing-sm);">üè¶ ÌÜµÏû•ÏÇ¨Î≥∏</h4>
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: var(--spacing-md);">
              <div>
                <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">ÏùÄÌñâÎ™Ö</p>
                <p style="font-weight: 600; margin: 0;">${ba.bankName || '-'}</p>
              </div>
              <div>
                <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">Í≥ÑÏ¢åÎ≤àÌò∏</p>
                <p style="font-weight: 600; margin: 0;">${ba.accountNumber || '-'}</p>
              </div>
              <div>
                <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">ÏòàÍ∏àÏ£º</p>
                <p style="font-weight: 600; margin: 0;">${ba.accountHolder || '-'}</p>
              </div>
            </div>
            <p style="font-size: 11px; color: var(--text-secondary); margin: 8px 0 0 0;">
              ÏµúÏ¢Ö ÏóÖÎç∞Ïù¥Ìä∏: ${ba.updatedAt ? new Date(ba.updatedAt).toLocaleString('ko-KR') : '-'}
            </p>
          </div>
        `;
      } else {
        bankAccountHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: #fff3cd; border-radius: var(--border-radius); border-left: 4px solid #ffc107;">
            <p style="margin: 0; font-size: 14px;">üè¶ <strong>ÌÜµÏû•ÏÇ¨Î≥∏</strong> - ÏßÅÏõêÏù¥ ÏïÑÏßÅ Îì±Î°ùÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§.</p>
          </div>
        `;
      }
      
      let healthCertHtml = '';
      if (employeeDocs.healthCert) {
        const hc = employeeDocs.healthCert;
        const expiryDate = hc.expiryDate ? new Date(hc.expiryDate) : null;
        const isExpired = expiryDate && expiryDate < new Date();
        const expiryBadge = isExpired ? 
          '<span class="badge badge-danger" style="margin-left: 8px;">‚ö†Ô∏è ÎßåÎ£åÎê®</span>' : 
          '<span class="badge badge-success" style="margin-left: 8px;">‚úÖ Ïú†Ìö®</span>';
        
        healthCertHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: ${isExpired ? '#fee2e2' : '#f0fdf4'}; border-radius: var(--border-radius); border-left: 4px solid ${isExpired ? '#ef4444' : '#22c55e'};">
            <h4 style="margin-bottom: var(--spacing-sm);">ü©∫ Î≥¥Í±¥Ï¶ù ${expiryBadge}</h4>
            ${hc.imageData ? `
              <div style="margin-bottom: var(--spacing-md); text-align: center;">
                <img src="${hc.imageData}" 
                     style="max-width: 100%; max-height: 200px; border: 2px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1);" 
                     onclick="window.open('${hc.imageData}', '_blank')"
                     title="ÌÅ¥Î¶≠ÌïòÎ©¥ ÌÅ¨Í≤å Î≥º Ïàò ÏûàÏäµÎãàÎã§">
                <p style="font-size: 11px; color: var(--text-secondary); margin-top: 4px;">üí° Ïù¥ÎØ∏ÏßÄÎ•º ÌÅ¥Î¶≠ÌïòÎ©¥ ÌÅ¨Í≤å Î≥º Ïàò ÏûàÏäµÎãàÎã§</p>
              </div>
            ` : '<p style="color: var(--text-secondary); margin-bottom: var(--spacing-md);">ÏóÖÎ°úÎìúÎêú Ïù¥ÎØ∏ÏßÄÍ∞Ä ÏóÜÏäµÎãàÎã§.</p>'}
            <div>
              <p style="font-size: 12px; color: var(--text-secondary); margin: 0 0 4px 0;">Ïú†Ìö®Í∏∞Í∞Ñ</p>
              <p style="font-weight: 600; margin: 0; font-size: 16px; color: ${isExpired ? '#ef4444' : '#22c55e'};">${hc.expiryDate || '-'}</p>
            </div>
            <p style="font-size: 11px; color: var(--text-secondary); margin: 8px 0 0 0;">
              ÏµúÏ¢Ö ÏóÖÎç∞Ïù¥Ìä∏: ${hc.updatedAt ? new Date(hc.updatedAt).toLocaleString('ko-KR') : '-'}
            </p>
          </div>
        `;
      } else {
        healthCertHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: #fff3cd; border-radius: var(--border-radius); border-left: 4px solid #ffc107;">
            <p style="margin: 0; font-size: 14px;">ü©∫ <strong>Î≥¥Í±¥Ï¶ù</strong> - ÏßÅÏõêÏù¥ ÏïÑÏßÅ Îì±Î°ùÌïòÏßÄ ÏïäÏïòÏäµÎãàÎã§.</p>
          </div>
        `;
      }
      
      const contractRows = contracts.map((contract, index) => {
        const createdDate = contract.createdAt ? new Date(contract.createdAt).toLocaleDateString('ko-KR') : '-';
        const statusBadge = contract.isSigned ? 
          '<span class="badge badge-success">‚úÖ ÏÑúÎ™ÖÏôÑÎ£å</span>' : 
          '<span class="badge badge-warning">‚è∞ ÏÑúÎ™ÖÎåÄÍ∏∞</span>';
        const isLatest = index === 0 ? '<span class="badge badge-primary" style="margin-left: 8px;">ÏµúÏã†</span>' : '';
        
        return `
          <tr>
            <td>${contracts.length - index}</td>
            <td>${contract.data.contractType || 'Í∑ºÎ°úÍ≥ÑÏïΩÏÑú'}${isLatest}</td>
            <td>${contract.data.startDate} ~ ${contract.data.endDate}</td>
            <td>${createdDate}</td>
            <td>${statusBadge}</td>
            <td>
              <button class="btn btn-sm btn-secondary" onclick="viewContract('${contract.id}')">üìÑ Î≥¥Í∏∞</button>
              <button class="btn btn-sm btn-primary" onclick="sendContractLink('${contract.id}')">üìß Ï†ÑÏÜ°</button>
            </td>
          </tr>
        `;
      }).join('');
      
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.display = 'flex';
      modal.id = 'employeeContractListModal';
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
          <div class="modal-header">
            <h3>üìã ${employeeName}ÎãòÏùò Ï†ïÎ≥¥</h3>
            <button class="modal-close" onclick="closeEmployeeContractListModal()">‚úï</button>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: var(--spacing-xl);">
              <h4 style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--border-color);">
                üìÑ Ï†úÏ∂ú ÏÑúÎ•ò
              </h4>
              ${bankAccountHtml}
              ${healthCertHtml}
            </div>
            <div>
              <h4 style="margin-bottom: var(--spacing-md); padding-bottom: var(--spacing-sm); border-bottom: 2px solid var(--border-color);">
                üìã Í≥ÑÏïΩÏÑú Î™©Î°ù
              </h4>
              <div style="margin-bottom: var(--spacing-md); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
                <p style="margin: 0; font-size: 14px; color: var(--text-secondary);">
                  üí° Ï¥ù <strong>${contracts.length}Í∞ú</strong>Ïùò Í≥ÑÏïΩÏÑúÍ∞Ä ÏûëÏÑ±ÎêòÏóàÏäµÎãàÎã§.
                </p>
              </div>
              <table>
                <thead>
                  <tr>
                    <th style="width: 60px;">Î≤àÌò∏</th>
                    <th>Í≥ÑÏïΩÏú†Ìòï</th>
                    <th>Í≥ÑÏïΩÍ∏∞Í∞Ñ</th>
                    <th>ÏûëÏÑ±Ïùº</th>
                    <th style="width: 120px;">ÏÉÅÌÉú</th>
                    <th style="width: 180px;">Í¥ÄÎ¶¨</th>
                  </tr>
                </thead>
                <tbody>
                  ${contractRows}
                </tbody>
              </table>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeEmployeeContractListModal()">Îã´Í∏∞</button>
            <button class="btn btn-danger" onclick="resignEmployee('${employeeName}', ${employeeId})">üö™ Ìá¥ÏÇ¨ Ï≤òÎ¶¨</button>
            <button class="btn btn-primary" onclick="openContractPage()">‚ûï ÏÉà Í≥ÑÏïΩÏÑú ÏûëÏÑ±</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function closeEmployeeContractListModal() {
      const modal = document.getElementById('employeeContractListModal');
      if (modal) modal.remove();
    }

    function resignEmployee(employeeName, employeeId) {
      const confirmMsg = `‚ö†Ô∏è ${employeeName}ÎãòÏùÑ Ìá¥ÏÇ¨ Ï≤òÎ¶¨ÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\nÎã§Ïùå Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ≠Ï†úÎê©ÎãàÎã§:\n‚Ä¢ ÌÜµÏû•ÏÇ¨Î≥∏\n‚Ä¢ Î≥¥Í±¥Ï¶ù\n‚Ä¢ ÏßÅÏõê ÏÑúÎ•ò Ï†ÑÏ≤¥\n\n‚Äª Í≥ÑÏïΩÏÑúÏôÄ Í∑ºÌÉú Í∏∞Î°ùÏùÄ Î≥¥Ï°¥Îê©ÎãàÎã§.`;
      if (!confirm(confirmMsg)) return;
      
      try {
        const docKey = `employee_docs_${employeeName}_${employeeId}`;
        localStorage.removeItem(docKey);
        alert(`‚úÖ ${employeeName}ÎãòÏù¥ Ìá¥ÏÇ¨ Ï≤òÎ¶¨ÎêòÏóàÏäµÎãàÎã§.`);
        closeEmployeeContractListModal();
        loadEmployees();
      } catch (error) {
        alert('‚ùå Ìá¥ÏÇ¨ Ï≤òÎ¶¨ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
      }
    }

    function getEmployeeIdFromContract(contract) {
      const employeeMap = {
        'ÍπÄÎØºÏàò': 1, 'Ïù¥ÏßÄÏùÄ': 2, 'Î∞ïÏÑúÏ§Ä': 3, 'ÏµúÏòÅÌù¨': 4, 'Ï†ïÏàòÎØº': 5, 'Í∞ïÌò∏Îèô': 6
      };
      return employeeMap[contract.employeeName] || 0;
    }

    function viewContract(id) {
      const contractData = localStorage.getItem(`contract_${id}`);
      if (!contractData) {
        alert('‚ö†Ô∏è Í≥ÑÏïΩÏÑúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        return;
      }
      try {
        const contract = JSON.parse(contractData);
        showContractViewModal(contract);
      } catch (e) {
        alert('‚ö†Ô∏è Í≥ÑÏïΩÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§.');
      }
    }

    function showContractViewModal(contract) {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.style.display = 'flex';
      modal.id = 'contractViewModal';
      
      const signLink = `${window.location.href.split('?')[0].replace('index.html', '')}contract-sign.html?id=${contract.id}`;
      const docKey = `employee_docs_${contract.employeeName}_${getEmployeeIdFromContract(contract)}`;
      const employeeDocs = JSON.parse(localStorage.getItem(docKey) || '{}');
      
      let bankAccountHtml = '';
      if (employeeDocs.bankAccount) {
        const ba = employeeDocs.bankAccount;
        bankAccountHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
            <h4 style="margin-bottom: var(--spacing-sm);">üè¶ ÌÜµÏû•ÏÇ¨Î≥∏</h4>
            <p><strong>ÏùÄÌñâÎ™Ö:</strong> ${ba.bankName || '-'}</p>
            <p><strong>Í≥ÑÏ¢åÎ≤àÌò∏:</strong> ${ba.accountNumber || '-'}</p>
            <p><strong>ÏòàÍ∏àÏ£º:</strong> ${ba.accountHolder || '-'}</p>
          </div>
        `;
      }
      
      let healthCertHtml = '';
      if (employeeDocs.healthCert) {
        const hc = employeeDocs.healthCert;
        healthCertHtml = `
          <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
            <h4 style="margin-bottom: var(--spacing-sm);">ü©∫ Î≥¥Í±¥Ï¶ù</h4>
            ${hc.imageData ? `
              <div style="margin-bottom: var(--spacing-md);">
                <img src="${hc.imageData}" style="max-width: 100%; max-height: 300px; border: 1px solid var(--border-color); border-radius: var(--border-radius); cursor: pointer;" onclick="window.open('${hc.imageData}', '_blank')">
              </div>
            ` : ''}
            <p><strong>Ïú†Ìö®Í∏∞Í∞Ñ:</strong> ${hc.expiryDate || '-'}</p>
          </div>
        `;
      }
      
      modal.innerHTML = `
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
          <div class="modal-header">
            <h3>üìÑ Í≥ÑÏïΩÏÑú ÏÉÅÏÑ∏Î≥¥Í∏∞</h3>
            <button class="modal-close" onclick="closeContractViewModal()">‚úï</button>
          </div>
          <div class="modal-body">
            <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
              <h4>üë§ Í∑ºÎ°úÏûê Ï†ïÎ≥¥</h4>
              <p><strong>Ïù¥Î¶Ñ:</strong> ${contract.employeeName}</p>
              <p><strong>ÏÉùÎÖÑÏõîÏùº:</strong> ${contract.employeeBirth}</p>
              <p><strong>Ï£ºÏÜå:</strong> ${contract.employeeAddress}</p>
              <p><strong>Ïó∞ÎùΩÏ≤ò:</strong> ${contract.employeePhone}</p>
            </div>
            ${bankAccountHtml}
            ${healthCertHtml}
            <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
              <h4>üè¢ ÌöåÏÇ¨ Ï†ïÎ≥¥</h4>
              <p><strong>ÌöåÏÇ¨Î™Ö:</strong> ${contract.companyName}</p>
              <p><strong>Í∑ºÎ¨¥Îß§Ïû•:</strong> ${contract.workStore}</p>
              <p><strong>ÏßÅÏ±Ö:</strong> ${contract.position}</p>
            </div>
            <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
              <h4>üìã Í≥ÑÏïΩ Ï†ïÎ≥¥</h4>
              <p><strong>Í≥ÑÏïΩÍ∏∞Í∞Ñ:</strong> ${contract.startDate} ~ ${contract.endDate}</p>
              <p><strong>Í∑ºÎ¨¥Ïùº:</strong> ${contract.workDays}</p>
              <p><strong>Í∑ºÎ¨¥ÏãúÍ∞Ñ:</strong> ${contract.workTime}</p>
              <p><strong>${contract.wageType}:</strong> ${contract.wageAmount}Ïõê</p>
            </div>
            <div style="margin-bottom: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-light); border-radius: var(--border-radius);">
              <h4>üîó ÏÑúÎ™Ö ÎßÅÌÅ¨</h4>
              <div style="display: flex; gap: 8px; align-items: center;">
                <input type="text" value="${signLink}" readonly style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 13px;">
                <button class="btn btn-primary btn-sm" onclick="copySignLink('${signLink}')">üìã Î≥µÏÇ¨</button>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeContractViewModal()">Îã´Í∏∞</button>
            <button class="btn btn-primary" onclick="sendContractLink('${contract.id}')">üìß ÎßÅÌÅ¨ Ï†ÑÏÜ°</button>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
    }

    function closeContractViewModal() {
      const modal = document.getElementById('contractViewModal');
      if (modal) modal.remove();
    }

    function copySignLink(link) {
      const tempInput = document.createElement('input');
      tempInput.value = link;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);
      alert('‚úÖ ÏÑúÎ™Ö ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
    }

    function sendContractLink(id) {
      const contractData = localStorage.getItem(`contract_${id}`);
      if (!contractData) {
        alert('‚ö†Ô∏è Í≥ÑÏïΩÏÑúÎ•º Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
        return;
      }
      
      try {
        const contract = JSON.parse(contractData);
        const signLink = `${window.location.href.split('?')[0].replace('index.html', '')}contract-sign.html?id=${id}`;
        
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.style.display = 'flex';
        modal.id = 'sendLinkModal';
        
        modal.innerHTML = `
          <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
              <h3>üìß ÏÑúÎ™Ö ÎßÅÌÅ¨ Ï†ÑÏÜ°</h3>
              <button class="modal-close" onclick="closeSendLinkModal()">‚úï</button>
            </div>
            <div class="modal-body">
              <p style="margin-bottom: 16px;"><strong>${contract.employeeName}</strong>ÎãòÍªò ÏÑúÎ™Ö ÎßÅÌÅ¨Î•º Ï†ÑÏÜ°Ìï©ÎãàÎã§.</p>
              <div style="margin-bottom: 16px;">
                <label style="font-weight: 600; display: block; margin-bottom: 8px;">üì± Ïó∞ÎùΩÏ≤ò</label>
                <input type="tel" value="${contract.employeePhone}" readonly style="width: 100%; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; background: var(--bg-light);">
              </div>
              <div style="margin-bottom: 16px;">
                <label style="font-weight: 600; display: block; margin-bottom: 8px;">üîó ÏÑúÎ™Ö ÎßÅÌÅ¨</label>
                <div style="display: flex; gap: 8px;">
                  <input type="text" id="linkToCopy" value="${signLink}" readonly style="flex: 1; padding: 8px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 13px;">
                  <button class="btn btn-primary btn-sm" onclick="copyLinkToSend()">üìã Î≥µÏÇ¨</button>
                </div>
              </div>
              <div style="padding: 16px; background: #fff3cd; border-radius: 4px; border: 1px solid #ffc107;">
                <p style="margin: 0; font-size: 14px;">üí° <strong>ÎßÅÌÅ¨ Î≥µÏÇ¨ ÌõÑ</strong> Ïπ¥Ïπ¥Ïò§ÌÜ°, Î¨∏Ïûê Îì±ÏúºÎ°ú ÏßÅÏõêÏóêÍ≤å Ï†ÑÎã¨ÌïòÏÑ∏Ïöî.</p>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary" onclick="closeSendLinkModal()">Îã´Í∏∞</button>
              <button class="btn btn-primary" onclick="copyAndClose()">üìã Î≥µÏÇ¨ÌïòÍ≥† Îã´Í∏∞</button>
            </div>
          </div>
        `;
        
        document.body.appendChild(modal);
      } catch (e) {
        alert('‚ö†Ô∏è Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
      }
    }

    function closeSendLinkModal() {
      const modal = document.getElementById('sendLinkModal');
      if (modal) modal.remove();
    }

    function copyLinkToSend() {
      const input = document.getElementById('linkToCopy');
      input.select();
      document.execCommand('copy');
      alert('‚úÖ ÏÑúÎ™Ö ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§!');
    }

    function copyAndClose() {
      copyLinkToSend();
      setTimeout(() => closeSendLinkModal(), 500);
    }

    function loadAttendanceList() {
      const tbody = document.getElementById('attendanceTableBody');
      if (!tbody) return;
      tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; color: var(--text-secondary);">Í∑ºÌÉú Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>';
    }

    function loadSalaryList() {
      const tbody = document.getElementById('salaryTableBody');
      if (!tbody) return;
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">Í∏âÏó¨ Ï†ïÎ≥¥Í∞Ä ÏóÜÏäµÎãàÎã§.</td></tr>';
    }

    function loadApprovals() {
      const tbody = document.getElementById('approvalsTableBody');
      if (!tbody) return;
      tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">ÏäπÏù∏ ÎåÄÍ∏∞ Í±¥Ïù¥ ÏóÜÏäµÎãàÎã§.</td></tr>';
    }

    function loadContracts() {
      const tbody = document.getElementById('contractsTableBody');
      if (!tbody) return;
      
      const allContracts = [];
      for (let i = 0; i < localStorage.length; i++) {
        const key = localStorage.key(i);
        if (key && key.startsWith('contract_C')) {
          try {
            const contractData = JSON.parse(localStorage.getItem(key));
            const contractId = key.replace('contract_', '');
            const signedContracts = JSON.parse(localStorage.getItem('signedContracts') || '[]');
            const isSigned = signedContracts.some(sc => sc.id === contractId);
            
            allContracts.push({
              id: contractId,
              name: contractData.employeeName,
              type: contractData.contractType,
              period: `${contractData.startDate} ~ ${contractData.endDate}`,
              createdAt: new Date(contractData.createdAt).toLocaleDateString('ko-KR'),
              status: isSigned ? 'ÏÑúÎ™ÖÏôÑÎ£å' : 'ÏÑúÎ™ÖÎåÄÍ∏∞',
              data: contractData
            });
          } catch (e) {}
        }
      }
      
      if (allContracts.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px; color: var(--text-secondary);"><p style="margin-bottom: 16px;">ÏÉùÏÑ±Îêú Í≥ÑÏïΩÏÑúÍ∞Ä ÏóÜÏäµÎãàÎã§.</p><button class="btn btn-primary" onclick="openContractPage()">+ Ï≤´ Í≥ÑÏïΩÏÑú ÏûëÏÑ±ÌïòÍ∏∞</button></td></tr>';
        return;
      }
      
      tbody.innerHTML = allContracts.map(con => {
        const statusClass = con.status === 'ÏÑúÎ™ÖÏôÑÎ£å' ? 'badge-success' : 'badge-warning';
        return `
          <tr>
            <td>${con.name}</td>
            <td>${con.type}</td>
            <td>${con.period}</td>
            <td>${con.createdAt}</td>
            <td><span class="badge ${statusClass}">${con.status}</span></td>
            <td>
              <button class="btn btn-sm btn-secondary" onclick="viewContract('${con.id}')">üìÑ Î≥¥Í∏∞</button>
              ${con.status === 'ÏÑúÎ™ÖÎåÄÍ∏∞' ? `<button class="btn btn-sm btn-primary" onclick="sendContractLink('${con.id}')">üìß ÎßÅÌÅ¨Ï†ÑÏÜ°</button>` : ''}
            </td>
          </tr>
        `;
      }).join('');
    }

    function loadNotice() {
      // Í≥µÏßÄÏÇ¨Ìï≠ Í∏∞Îä• Ï∂îÌõÑ Íµ¨ÌòÑ
    }

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
    }

    // Í≥ÑÏïΩÏÑú ÏûëÏÑ± ÌéòÏù¥ÏßÄ Ïó¥Í∏∞
    function openContractPage() {
      // Î∞©Î≤ï 1: ÏÉà ÌÉ≠ÏúºÎ°ú Ïó¥Í∏∞ (Í∞ÄÏû• ÏïàÏ†Ñ)
      const contractWindow = window.open('contract.html', '_blank');
      
      // ÌåùÏóÖÏù¥ Ï∞®Îã®ÎêòÏóàÏùÑ Í≤ΩÏö∞ ÎåÄÎπÑ
      if (!contractWindow) {
        // Î∞©Î≤ï 2: ÌòÑÏû¨ ÌÉ≠ÏóêÏÑú Ïó¥Í∏∞
        if (confirm('Í≥ÑÏïΩÏÑú ÏûëÏÑ± ÌéòÏù¥ÏßÄÎ°ú Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?\n\n‚Äª ÏûëÏÑ± ÌõÑ Îí§Î°úÍ∞ÄÍ∏∞Î°ú ÎèåÏïÑÏò¨ Ïàò ÏûàÏäµÎãàÎã§.')) {
          window.location.href = 'contract.html';
        }
      }
    }
  </script>
</body>
</html>
