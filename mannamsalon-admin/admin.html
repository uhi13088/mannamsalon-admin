<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>관리자 - 맛남살롱</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f5f5;
      min-height: 100vh;
    }

    /* 상단 바 */
    .top-bar {
      background: white;
      padding: 20px 32px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 32px;
    }

    .top-bar h1 {
      font-size: 24px;
      color: #333;
      margin: 0;
    }

    .top-bar-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: #f5f5f5;
      border-radius: 20px;
    }

    .user-info span {
      font-weight: 600;
      color: #333;
    }

    .btn-logout {
      padding: 8px 16px;
      background: #dc3545;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .btn-logout:hover {
      background: #c82333;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* 통계 카드 */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .stat-icon {
      font-size: 32px;
      margin-bottom: 12px;
    }

    .stat-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      color: #333;
    }

    /* 환영 카드 */
    .welcome-card {
      background: white;
      border-radius: 12px;
      padding: 32px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      text-align: center;
    }

    .welcome-card h2 {
      font-size: 32px;
      color: #333;
      margin-bottom: 16px;
    }

    .welcome-card p {
      font-size: 16px;
      color: #666;
      margin-bottom: 32px;
    }

    /* 빠른 작업 버튼 */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 32px;
    }

    .quick-action-btn {
      padding: 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.2s ease;
      text-align: center;
    }

    .quick-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
    }

    .quick-action-icon {
      font-size: 32px;
      margin-bottom: 8px;
    }

    /* 로딩 */
    .loading-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      align-items: center;
      justify-content: center;
    }

    .loading-overlay.show {
      display: flex;
    }

    .loading-spinner {
      background: white;
      padding: 32px;
      border-radius: 8px;
      text-align: center;
    }

    .spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* 반응형 */
    @media (max-width: 768px) {
      .top-bar {
        flex-direction: column;
        gap: 16px;
        align-items: flex-start;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- 로딩 오버레이 -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>인증 확인 중...</p>
    </div>
  </div>

  <!-- 상단 바 -->
  <div class="top-bar">
    <h1>🏪 맛남살롱 관리자</h1>
    <div class="top-bar-right">
      <div class="user-info">
        <span>👨‍💼</span>
        <span id="userName">관리자</span>
      </div>
      <button class="btn-logout" onclick="logout()">로그아웃</button>
    </div>
  </div>

  <div class="container">
    <!-- 통계 카드 -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-icon">👥</div>
        <div class="stat-label">총 직원 수</div>
        <div class="stat-value" id="totalEmployees">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">✅</div>
        <div class="stat-label">금일 출근</div>
        <div class="stat-value" id="todayAttendance">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">📄</div>
        <div class="stat-label">대기 중인 계약</div>
        <div class="stat-value" id="pendingContracts">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-icon">💰</div>
        <div class="stat-label">이번 달 급여</div>
        <div class="stat-value" id="monthlySalary">0원</div>
      </div>
    </div>

    <!-- 환영 메시지 -->
    <div class="welcome-card">
      <h2>관리자 대시보드에 오신 것을 환영합니다!</h2>
      <p>맛남살롱 근무관리 시스템이 정상적으로 작동하고 있습니다.</p>
      
      <div class="quick-actions">
        <button class="quick-action-btn" onclick="navigateToContract()">
          <div class="quick-action-icon">📝</div>
          <div>계약서 작성</div>
        </button>
        <button class="quick-action-btn" onclick="alert('직원 관리 기능은 개발 중입니다.')">
          <div class="quick-action-icon">👥</div>
          <div>직원 관리</div>
        </button>
        <button class="quick-action-btn" onclick="alert('근태 관리 기능은 개발 중입니다.')">
          <div class="quick-action-icon">📊</div>
          <div>근태 관리</div>
        </button>
        <button class="quick-action-btn" onclick="alert('급여 관리 기능은 개발 중입니다.')">
          <div class="quick-action-icon">💰</div>
          <div>급여 관리</div>
        </button>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    // Firebase 설정
    const firebaseConfig = {
      apiKey: "AIzaSyCr3Tq2T7oy5rVlK1c33m_G0TlUWv0-g3k",
      authDomain: "abcdc-staff-system.firebaseapp.com",
      projectId: "abcdc-staff-system",
      storageBucket: "abcdc-staff-system.firebasestorage.app",
      messagingSenderId: "442207878284",
      appId: "1:442207878284:web:49b157573851b124d28fa9",
      measurementId: "G-WYPQ3YEJRT"
    };

    // Firebase 초기화
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    console.log('✅ Firebase 초기화 완료');

    const loadingOverlay = document.getElementById('loadingOverlay');

    // 로딩 표시
    loadingOverlay.classList.add('show');

    // 인증 확인
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        // 로그인하지 않은 경우
        console.log('❌ 로그인 필요');
        alert('로그인이 필요합니다.');
        window.location.href = 'index.html';
        return;
      }

      try {
        console.log('🔍 사용자 정보 조회:', user.uid);

        // Firestore에서 사용자 정보 가져오기
        const userDoc = await db.collection('users').doc(user.uid).get();
        
        if (!userDoc.exists) {
          throw new Error('사용자 정보를 찾을 수 없습니다.');
        }

        const userData = userDoc.data();
        console.log('✅ 사용자 정보:', userData);

        // 관리자 권한 확인
        if (userData.userType !== 'admin') {
          throw new Error('관리자 권한이 필요합니다.');
        }

        if (userData.status !== 'active') {
          throw new Error('비활성화된 계정입니다.');
        }

        // 사용자 이름 표시
        document.getElementById('userName').textContent = userData.name || '관리자';

        // 세션 저장
        sessionStorage.setItem('user', JSON.stringify({
          uid: user.uid,
          email: user.email,
          ...userData
        }));

        console.log('✅ 관리자 인증 완료');

        // 통계 로드
        loadStats();

        // 로딩 숨김
        loadingOverlay.classList.remove('show');

      } catch (error) {
        console.error('❌ 인증 오류:', error);
        alert(error.message);
        await auth.signOut();
        window.location.href = 'index.html';
      }
    });

    // 통계 로드 (임시)
    async function loadStats() {
      try {
        // TODO: 실제 데이터로 교체
        document.getElementById('totalEmployees').textContent = '0';
        document.getElementById('todayAttendance').textContent = '0';
        document.getElementById('pendingContracts').textContent = '0';
        document.getElementById('monthlySalary').textContent = '0원';
      } catch (error) {
        console.error('통계 로드 실패:', error);
      }
    }

    // 계약서 페이지로 이동
    function navigateToContract() {
      // 임시: 알림으로 안내
      alert('계약서 작성 기능:\n\n1. contract.html을 별도로 배포해주세요\n2. 배포된 URL을 알려주시면 연결하겠습니다\n\n또는\n\nindex.html (메인 관리자 페이지)를 사용해주세요');
      
      // 방법 1: 상대 경로 시도
      // window.location.href = 'contract.html';
      
      // 방법 2: 새 탭으로 열기
      // window.open('contract.html', '_blank');
      
      // 방법 3: index.html로 이동 (만약 index.html에 계약서 기능이 있다면)
      // window.location.href = 'index.html';
    }

    // 로그아웃
    async function logout() {
      if (confirm('로그아웃 하시겠습니까?')) {
        try {
          await auth.signOut();
          sessionStorage.clear();
          console.log('✅ 로그아웃 완료');
          window.location.href = 'index.html';
        } catch (error) {
          console.error('❌ 로그아웃 실패:', error);
          alert('로그아웃 중 오류가 발생했습니다.');
        }
      }
    }
  </script>
</body>
</html>
